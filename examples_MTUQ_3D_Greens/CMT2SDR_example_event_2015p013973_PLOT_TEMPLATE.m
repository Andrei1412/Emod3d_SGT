% close all
M0 = zeros(3);
% %srf-event:
% strike = 69 	 	 ; dip = 90; rake = 151; %3505099 	20110429190800 	-43.1842 	171.9868 	69 	90 	151 	159 	61 	0
% strike = 263 	 	 ; dip = 84; rake =  -163;  %2013p544960 	20130721151500 	-41.4503 	174.2992 	263 	84 	-163 	171 	73 	-7
%  strike = 140 	 ; dip = 85; rake =  11; %2013p616691 	20130817041300 	-41.7793 	173.9923 	140 	85 	11 	49 	79 	175
%  strike = 243 	 ; dip = 83; rake =  170; %2013p666224 	20130904120400 	-41.5003 	174.4235 	243 	83 	170 	334 	80 	7
strike = 252 	 	 ; dip = 82; rake =  150; %2015p013973 	20150106040400 	-43.0628 	171.2858 	252 	82 	150 	347 	60 	10 
% strike = 72 	     ; dip = 88; rake =  -171; %2017p135277 	20170220011600 	-42.7568 	172.8294 	72 	88 	-171 	342 	81 	-2
% %Cartesian format: east/ north/ depth or x/ y/ z
MT = sdr2mt(strike,dip,rake); 
%M0 = [Mrr, Mrp, Mrt; Mrp, Mpp, Mpt; Mrt, Mpt, Mtt]; %Similar to obspy format!
M0(1,1) = MT(1); M0(3,3) = MT(2); M0(2,2) = MT(3);
M0(1,2) = MT(5); M0(1,3) = MT(4); M0(2,3) = MT(6);
M0(2,1) = MT(5); M0(3,1) = MT(4); M0(3,2) = MT(6);

disp(M0)
fig = figure(1);
set(gcf,'Position',[100 100 600 150])
subplot(1,2,1)
plotmt(M0,0,0,1,'k'), axis equal
title(num2str([strike,dip,rake]))
% M0 = [0,0,0;0,0,0;0,0,1]
% M0 = [ 0.37942488,  0.73431469, -0.49435213;        0.73431469, -0.51724356,  0.03389469;      -0.49435213,  0.03389469,  0.13781868];

%AA_ishot[i,k,:,1] = AA_ishot[i,k,:,1];AA_ishot[i,k,:,2] = AA_ishot[i,k,:,2];AA_ishot[i,k,:,5] = AA_ishot[i,k,:,5];
% M0 = [715.79886312, -126.31555415, -117.75515857; -126.31555415, -433.55329323,  -143.72446339; -117.75515857, -143.72446339, -282.27922885];
% M0 = [672.38833673, -129.92497071, -119.77069213; -129.92497071, -402.14364265,  -148.23038117; -119.77069213, -148.23038117, -270.27023143];

%AA_ishot[i,k,:,1] = 0.5*AA_ishot[i,k,:,1];AA_ishot[i,k,:,2] = 0.5*AA_ishot[i,k,:,2];AA_ishot[i,k,:,5] = 0.5*AA_ishot[i,k,:,5];
% M0 = [672.36283578, -259.84963605, -239.54159678; -259.84963605, -402.16858363,  -296.46210877; -239.54159678, -296.46210877, -270.29639328];
%Source 3350500 syn/good:
% M0 = [-759.82573324, -1116.27900816,  -190.96035432; -1116.27900816,   1227.14751906,  -634.0305229;   -190.96035432,  -634.0305229,   -467.04640632];
%Source 2015p013973 real/good:
%fhight =0.1Hz, Nri changes with SGT filter
%dz=-1
% M0 = [ 6.87956071, 10.09570202, -7.2450647;  10.09570202, -9.32619784,-8.2668072; -7.2450647,  -8.2668072,   2.45171397];
%dz=0
% M0 = [9.23971024,  10.89159552,  -7.16830679;  10.89159552, -11.58612791,  -8.58042646;  -7.16830679,  -8.58042646,   2.34951041];
%dz=1
% M0 = [12.00215642,  12.03707681,  -7.55238557;  12.03707681,-15.00557778,  -9.61487429;  -7.55238557,  -9.61487429,   3.00577141];

%fhight =0.1Hz, Nri changes, no SGT filter
%dz=-1
% M0 = [0.4135482,   0.398578,    0.11773485;  0.398578,   -0.53131332, -0.7466253;  0.11773485, -0.7466253,   0.11742436];
%dz=0
% M0 = [0.36039678,  0.41041883,  0.06401002;  0.41041883, -0.51220922, -0.87344729;  0.06401002, -0.87344729,  0.15162139];
%dz=1
% M0 = [0.28577795,  0.3381255,   0.02892362;  0.3381255,  -0.38743361,-0.67241769;  0.02892362, -0.67241769,  0.10145979];

% fhight =0.2Hz, Nri changes, no SGT filter
%dz=-1
% M0 = [-1.90737087, -0.69910445, -1.97568125; -0.69910445, -1.82108516, -6.12461634; -1.97568125, -6.12461634,  3.73671721];
%dz=0
% M0 = [-1.404992,   -0.60109089, -1.72815157; -0.60109089, -1.85682298, -5.15752157; -1.72815157, -5.15752157,  3.26705375];
%dz=1
% M0 = [-1.07630485, -1.04596219, -0.95144602; -1.04596219, -1.40789774,-3.03627232; -0.95144602, -3.03627232,  2.4878794];

% fhight =0.2Hz, Nri changes, with SGT filter
%dz=-1
% M0 = [11.52842333,  17.38996371,  77.54082791;  17.38996371, 56.30541562,  98.91465816;  77.54082791,  98.91465816, -67.78809713];
%dz=0
% M0 = [-11.20902881,  15.2093164,   72.20974475;  15.2093164, 58.17311821,  93.14458337;  72.20974475,  93.14458337, -46.92703074];
%dz=1
% M0 = [-29.52710635,  14.40098479,  73.40486051;  14.40098479,62.79577856,  96.89678597;  73.40486051,  96.89678597, -33.22778714];

% % fhight =0.2Hz, Nri changes - 3 comps, with SGT filter
% M0 = [-13.23186156, -90.58966595, -61.02521962; -90.58966595, 105.34103287, -41.38429804; -61.02521962, -41.38429804, -92.17174339];
% M0 = [-17.2028129,  -76.59403164, -54.34970353; -76.59403164, 100.77373054, -45.60966156; -54.34970353, -45.60966156, -83.59892058];
% M0 = [-26.01106655, -59.87322129, -50.19708195; -59.87322129, 113.71444066, -54.30063524; -50.19708195, -54.30063524, -87.71376273];

% % fhight =0.1Hz, Nri changes - 3 comps, with SGT filter
% M0 = [19.22813372,  21.08470428, -13.88270324;  21.08470428, -26.82498534,  65.53762436; -13.88270324,  65.53762436,   7.62249221];
% M0 = [12.47433755,  19.23913664, -16.63735007;  19.23913664, -18.85491138,  82.94854343; -16.63735007,  82.94854343 ,  6.40083439];
% M0 = [ 10.29864429,  20.26543128, -20.22299123 ; 20.26543128, -19.55379726, 110.46895395; -20.22299123, 110.46895395,   9.27654252];

% M0 = [14.61311548,  22.77239822, -10.77759641;  22.77239822, -24.61850259,  71.84235481; -10.77759641,  71.84235481,  10.03473439];
% M0 = [7.74570456, 14.72341865, -1.38321828; 14.72341865, -7.19339941, 19.6540113; -1.38321828, 19.6540113,  -0.52178943];
%Syn test dz=0
% M0 = [-194.20875978, -294.74668319,  -96.01468129; -294.74668319,  393.20133935, -219.07596826;  -96.01468129, -219.07596826, -199.05269463];

%Source 2015p013973 syn/ good:
M0 = [ -407.23700007,  -502.35137968,    -5.64346605;  -502.35137968,    428.31698505,   293.30062426;    -5.64346605,   293.30062426,    -21.10671183];

% M0 = [36.75378715,  40.27750828,  21.29866508 ; 40.27750828, -45.95576931,  -2.85596442;  21.29866508,  -2.85596442 ,  9.28249199];
% M0 = [-406.14679624, -501.23926818,   -5.59461924; -501.23926818,  425.19611036,  292.53959864;   -5.59461924,  292.53959864,  -19.08599104];%fhight =0.1Hz, Nri changes
% M0 = [-348.120055,   -486.59960455,    3.55950051; -486.59960455,  403.31427303,   297.39543838;    3.55950051,  297.39543838,  -55.25791609];
% M0 = [-3.92821656,  11.6963639,   31.54771786;  11.6963639,   23.38444054,  49.57796483;  31.54771786,  49.57796483, -19.45634997];

%3depths with synthetics
% M0 = [-347.38529481, -485.25080762,    3.52928522; -485.25080762,  399.80419438,  296.57317215;    3.52928522,  296.57317215,  -52.4951875];
% M0 = [-406.14679624, -501.23926818,   -5.59461924; -501.23926818,  425.19611036,  292.53959864;   -5.59461924,  292.53959864,  -19.08599104];
% M0 = [-454.67710915, -513.24213358,   -4.78906841; -513.24213358,  446.2833592,  322.64114601;   -4.78906841,  322.64114601,    8.33975344];
%%Plot Solution
% figure(10)

subplot(1,2,2)
% plotmt(M0,0,0,1,'k'), axis equal
% convert strike-dip-rake to HRV mt
%[Mrr,Mtt,Mpp,Mrt,Mrp,Mtp]
Mrr = M0(3,3); Mtt = M0(1,1); Mpp = M0(2,2);
Mrt = M0(1,3); Mrp = -M0(2,3); Mtp = -M0(1,2);
% f = strike, d = dip, l = rake
%1 Mrr =  Mzz =  Mo sin2d sinl
%2 Mtt =  Mxx = -Mo(sind cosl sin2f +     sin2d sinl (sinf)^2 )
%3 Mpp =  Myy =  Mo(sind cosl sin2f -     sin2d sinl (cosf)^2 )
%4 Mrt =  Mxz = -Mo(cosd cosl cosf  +     cos2d sinl sinf )
%5 Mrp = -Myz =  Mo(cosd cosl sinf  -     cos2d sinl cosf )
%6 Mtp = -Mxy = -Mo(sind cosl cos2f + 0.5 sin2d sinl sin2f )
%Havard format: up/ south, east or radius/ theta/ phi
% [Mxx, Myy, Mzz, Mxy, Mxz, Myz] = [0.37942488, -0.51724356,  0.13781868,  0.73431469, -0.49435213,        0.03389469];
% [Mtt, Mpp, Mrr, Mtp, Mrt, Mrp] = [0.37942488, -0.51724356,  0.13781868,  -0.73431469, -0.49435213,        -0.03389469];
% Mtt = 0.37942488; Mpp = -0.51724356; Mrr = 0.13781868; Mtp = -0.73431469;  Mrt = -0.49435213; Mrp =  -0.03389469;

%Rob's CMT:
% [Mxx, Myy, Mzz, Mxy, Mxz, Myz] = [-0.51724356,  0.37942488,  0.13781868, -0.73431469,  0.03389469,        0.49435213];
% [Mtt, Mpp, Mrr, Mtp, Mrt, Mrp] = [-0.51724356, 0.37942488,  0.13781868,  -0.73431469, -0.49435213,        -0.03389469];
% Mtt = -0.51724356; Mpp = 0.37942488; Mrr = 0.13781868; Mtp = 0.73431469;  Mrt = 0.03389469; Mrp =  -0.49435213;
% 
% MT = [Mrr,Mtt,Mpp,Mrt,Mrp,Mtp];
sdr = round(mt2sdr([Mrr,Mtt,Mpp,Mrt,Mrp,Mtp]))

%Correct the strike rotation!
sdr(1) = sdr(1)+90
% sdr = round(mt2sdr(MT))
% % 
MT = sdr2mt(sdr);
M0(1,1) = MT(1); M0(3,3) = MT(2); M0(2,2) = MT(3);
M0(1,2) = MT(5); M0(1,3) = MT(4); M0(2,3) = MT(6);
M0(2,1) = MT(5); M0(3,1) = MT(4); M0(3,2) = MT(6);
plotmt(M0,0,0,1,'k'), axis equal
title(num2str(sdr))
% title('[Mxx, Myy, Mzz, Mxy, Mxz, Myz] = [0.37942488, -0.51724356,  0.13781868,  0.73431469, -0.49435213,        0.03389469]')
% title('[Mxx, Myy, Mzz, Mxy, Mxz, Myz] = [-0.51724356,  0.37942488,  0.13781868, -0.73431469,  0.03389469,        0.49435213]')
% title(strcat('[Mxx, Myy, Mzz, Mxy, Mxz, Myz] = ',num2str([Mtt, Mpp, Mrr, -Mtp, Mrt, -Mrp])))
saveas(fig,'Geonet_vs_direct_CMT_solution.jpg');
% savefig(fig,'Balls.jpg');